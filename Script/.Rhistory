#server<-phantomjs(port=5012L)
#Abrimos el navegador
Browser <- remoteDriver(browserName = "phantomjs", port=5012L)
Browser$open()
#Sys.sleep(1)
#Navegamos
Browser$navigate(UrlExpe) #
#Sys.sleep(1)
Browser$screenshot(display=TRUE)
#Sys.sleep(1)
#Hacer clic en expediente
Pagina_actual<-Browser$getPageSource()
#De la siguiente forma no hace efecto
# Expediente <- Browser$findElement(using = "css",
#                                   value = "#DvDetalle_LinkExpediente")
# Expediente$clickElement()
# Browser$screenshot(display=TRUE)
#Aqui si funciona
#expedientes_url<-"EXPEDIENTES"
ExpedienteUrl <- read_html(Pagina_actual[[1]])%>%
html_node(css = "#DvDetalle_LinkExpediente")%>%
html_attr("href")
#expedientes_url="EXPEDIENTES"
#saveRDS(ExpedienteUrl,file = paste0("Leyes/Exp_",i,".rds"))
data=rbind(data, ExpedienteUrl)
# expedientes_url
}
View(data)
View(data)
#nrow(NumeroLey)
data<-"BASE DE URLS"
for (i in 1:10){
UrlExpe <- "https://leyes.congreso.gob.pe/DetLeyNume_1p.aspx?xNorma=6&xNumero="
UrlExpe <- paste0(UrlExpe,NumeroLey[i,1],"&xTipoNorma=0") #1829
options(encoding = "utf-8") # Le asignamos el encoding
#Abrimos una sesion en la web
# Ejecutamos el servidor phantomjs -creamos un navegador fantasma
#server<-phantomjs(port=5012L)
#Abrimos el navegador
Browser <- remoteDriver(browserName = "phantomjs", port=5012L)
Browser$open()
#Sys.sleep(1)
#Navegamos
Browser$navigate(UrlExpe) #
#Sys.sleep(1)
Browser$screenshot(display=TRUE)
#Sys.sleep(1)
#Hacer clic en expediente
Pagina_actual<-Browser$getPageSource()
#De la siguiente forma no hace efecto
# Expediente <- Browser$findElement(using = "css",
#                                   value = "#DvDetalle_LinkExpediente")
# Expediente$clickElement()
# Browser$screenshot(display=TRUE)
#Aqui si funciona
#expedientes_url<-"EXPEDIENTES"
ExpedienteUrl <- read_html(Pagina_actual[[1]])%>%
html_node(css = "#DvDetalle_LinkExpediente")%>%
html_attr("href")
#expedientes_url="EXPEDIENTES"
#saveRDS(ExpedienteUrl,file = paste0("Leyes/Exp_",i,".rds"))
data=rbind(data, ExpedienteUrl)
# expedientes_url
}
View(data)
for (i in 1:nrow(NumeroLey)){
UrlExpe <- "https://leyes.congreso.gob.pe/DetLeyNume_1p.aspx?xNorma=6&xNumero="
UrlExpe <- paste0(UrlExpe,NumeroLey[i,1],"&xTipoNorma=0") #1829
options(encoding = "utf-8") # Le asignamos el encoding
#Abrimos una sesion en la web
# Ejecutamos el servidor phantomjs -creamos un navegador fantasma
#server<-phantomjs(port=5012L)
#Abrimos el navegador
Browser <- remoteDriver(browserName = "phantomjs", port=5012L)
Browser$open()
#Sys.sleep(1)
#Navegamos
Browser$navigate(UrlExpe) #
#Sys.sleep(1)
Browser$screenshot(display=TRUE)
#Sys.sleep(1)
#Hacer clic en expediente
Pagina_actual<-Browser$getPageSource()
#De la siguiente forma no hace efecto
# Expediente <- Browser$findElement(using = "css",
#                                   value = "#DvDetalle_LinkExpediente")
# Expediente$clickElement()
# Browser$screenshot(display=TRUE)
#Aqui si funciona
#expedientes_url<-"EXPEDIENTES"
ExpedienteUrl <- read_html(Pagina_actual[[1]])%>%
html_node(css = "#DvDetalle_LinkExpediente")%>%
html_attr("href")
#expedientes_url="EXPEDIENTES"
#saveRDS(ExpedienteUrl,file = paste0("Leyes/Exp_",i,".rds"))
data=rbind(data, ExpedienteUrl)
# expedientes_url
}
UrlExpe
for (i in 1:nrow(NumeroLey)){
UrlExpe <- "https://leyes.congreso.gob.pe/DetLeyNume_1p.aspx?xNorma=6&xNumero="
UrlExpe <- paste0(UrlExpe,NumeroLey[i,1],"&xTipoNorma=0") #1829
options(encoding = "utf-8") # Le asignamos el encoding
#Abrimos una sesion en la web
# Ejecutamos el servidor phantomjs -creamos un navegador fantasma
#server<-phantomjs(port=5012L)
#Abrimos el navegador
Browser <- remoteDriver(browserName = "phantomjs", port=5012L)
Browser$open()
#Sys.sleep(1)
#Navegamos
Browser$navigate(UrlExpe) #
#Sys.sleep(1)
Browser$screenshot(display=TRUE)
#Sys.sleep(1)
#Hacer clic en expediente
Pagina_actual<-Browser$getPageSource()
#De la siguiente forma no hace efecto
# Expediente <- Browser$findElement(using = "css",
#                                   value = "#DvDetalle_LinkExpediente")
# Expediente$clickElement()
# Browser$screenshot(display=TRUE)
#Aqui si funciona
#expedientes_url<-"EXPEDIENTES"
ExpedienteUrl <- read_html(Pagina_actual[[1]])%>%
html_node(css = "#DvDetalle_LinkExpediente")%>%
html_attr("href")
#expedientes_url="EXPEDIENTES"
#saveRDS(ExpedienteUrl,file = paste0("Leyes/Exp_",i,".rds"))
data=rbind(data, ExpedienteUrl)
# expedientes_url
}
for (i in 1:100){
UrlExpe <- "https://leyes.congreso.gob.pe/DetLeyNume_1p.aspx?xNorma=6&xNumero="
UrlExpe <- paste0(UrlExpe,NumeroLey[i,1],"&xTipoNorma=0") #1829
options(encoding = "utf-8") # Le asignamos el encoding
#Abrimos una sesion en la web
# Ejecutamos el servidor phantomjs -creamos un navegador fantasma
#server<-phantomjs(port=5012L)
#Abrimos el navegador
Browser <- remoteDriver(browserName = "phantomjs", port=5012L)
Browser$open()
#Sys.sleep(1)
#Navegamos
Browser$navigate(UrlExpe) #
#Sys.sleep(1)
Browser$screenshot(display=TRUE)
#Sys.sleep(1)
#Hacer clic en expediente
Pagina_actual<-Browser$getPageSource()
#De la siguiente forma no hace efecto
# Expediente <- Browser$findElement(using = "css",
#                                   value = "#DvDetalle_LinkExpediente")
# Expediente$clickElement()
# Browser$screenshot(display=TRUE)
#Aqui si funciona
#expedientes_url<-"EXPEDIENTES"
ExpedienteUrl <- read_html(Pagina_actual[[1]])%>%
html_node(css = "#DvDetalle_LinkExpediente")%>%
html_attr("href")
#expedientes_url="EXPEDIENTES"
#saveRDS(ExpedienteUrl,file = paste0("Leyes/Exp_",i,".rds"))
data=rbind(data, ExpedienteUrl)
# expedientes_url
}
View(data)
View(NumeroLey)
#nrow(NumeroLey)
data<-"BASE DE URLS"
for (i in 1:100){
UrlExpe <- "https://leyes.congreso.gob.pe/DetLeyNume_1p.aspx?xNorma=6&xNumero="
UrlExpe <- paste0(UrlExpe,NumeroLey[i,1],"&xTipoNorma=0") #1829
options(encoding = "utf-8") # Le asignamos el encoding
#Abrimos una sesion en la web
# Ejecutamos el servidor phantomjs -creamos un navegador fantasma
#server<-phantomjs(port=5012L)
#Abrimos el navegador
Browser <- remoteDriver(browserName = "phantomjs", port=5012L)
Browser$open()
#Sys.sleep(1)
#Navegamos
Browser$navigate(UrlExpe) #
#Sys.sleep(1)
Browser$screenshot(display=TRUE)
#Sys.sleep(1)
#Hacer clic en expediente
Pagina_actual<-Browser$getPageSource()
#De la siguiente forma no hace efecto
# Expediente <- Browser$findElement(using = "css",
#                                   value = "#DvDetalle_LinkExpediente")
# Expediente$clickElement()
# Browser$screenshot(display=TRUE)
#Aqui si funciona
#expedientes_url<-"EXPEDIENTES"
ExpedienteUrl <- read_html(Pagina_actual[[1]])%>%
html_node(css = "#DvDetalle_LinkExpediente")%>%
html_attr("href")
#expedientes_url="EXPEDIENTES"
#saveRDS(ExpedienteUrl,file = paste0("Leyes/Exp_",i,".rds"))
data=rbind(data, ExpedienteUrl)
# expedientes_url
}
View(data)
#nrow(NumeroLey)
data<-"BASE DE URLS"
for (i in 1:100){
UrlExpe <- "https://leyes.congreso.gob.pe/DetLeyNume_1p.aspx?xNorma=6&xNumero="
UrlExpe <- paste0(UrlExpe,NumeroLey[i,1],"&xTipoNorma=0") #1829
options(encoding = "utf-8") # Le asignamos el encoding
#Abrimos una sesion en la web
# Ejecutamos el servidor phantomjs -creamos un navegador fantasma
#server<-phantomjs(port=5012L)
#Abrimos el navegador
Browser <- remoteDriver(browserName = "phantomjs", port=5012L)
Browser$open()
#Sys.sleep(1)
#Navegamos
Browser$navigate(UrlExpe) #
#Sys.sleep(1)
Browser$screenshot(display=TRUE)
#Sys.sleep(1)
#Hacer clic en expediente
Pagina_actual<-Browser$getPageSource()
#De la siguiente forma no hace efecto
# Expediente <- Browser$findElement(using = "css",
#                                   value = "#DvDetalle_LinkExpediente")
# Expediente$clickElement()
# Browser$screenshot(display=TRUE)
#Aqui si funciona
#expedientes_url<-"EXPEDIENTES"
ExpedienteUrl <- read_html(Pagina_actual[[1]])%>%
html_node(css = "#DvDetalle_LinkExpediente")%>%
html_attr("href")
#expedientes_url="EXPEDIENTES"
#saveRDS(ExpedienteUrl,file = paste0("Leyes/Exp_",i,".rds"))
data=append(data, ExpedienteUrl)
# expedientes_url
}
# TodasLeyes <- TodasLeyes%>%
#   filter(Norma!="RESOLUCION LEGISLATIVA")
TodasLeyes <- TodasLeyes%>%
filter(Norma!="RESOLUCION LEGISLATIVA")
#Guardar la data Limpia
saveRDS(TodasLeyes,"Leyes/TodasLeyes.rds")
#---- Acceder al expediente #----
TodasLeyes <- readRDS("Leyes/TodasLeyes.rds")
NumeroLey <- TodasLeyes$Número
NumeroLey <-as.data.frame(NumeroLey)
NumeroLey[1,1]
#ExpedienteUrl
#expedientes_url<-rbind(expedientes_url,ExpedienteUrl)
#expedientes_url
#data=rbind(ExpedienteUrl, ExpedienteUrl)
####automatizando
server<-phantomjs(port=5012L)
#nrow(NumeroLey)
data<-"BASE DE URLS"
for (i in 1:100){
UrlExpe <- "https://leyes.congreso.gob.pe/DetLeyNume_1p.aspx?xNorma=6&xNumero="
UrlExpe <- paste0(UrlExpe,NumeroLey[i,1],"&xTipoNorma=0") #1829
options(encoding = "utf-8") # Le asignamos el encoding
#Abrimos una sesion en la web
# Ejecutamos el servidor phantomjs -creamos un navegador fantasma
#server<-phantomjs(port=5012L)
#Abrimos el navegador
Browser <- remoteDriver(browserName = "phantomjs", port=5012L)
Browser$open()
#Sys.sleep(1)
#Navegamos
Browser$navigate(UrlExpe) #
#Sys.sleep(1)
Browser$screenshot(display=TRUE)
#Sys.sleep(1)
#Hacer clic en expediente
Pagina_actual<-Browser$getPageSource()
#De la siguiente forma no hace efecto
# Expediente <- Browser$findElement(using = "css",
#                                   value = "#DvDetalle_LinkExpediente")
# Expediente$clickElement()
# Browser$screenshot(display=TRUE)
#Aqui si funciona
#expedientes_url<-"EXPEDIENTES"
ExpedienteUrl <- read_html(Pagina_actual[[1]])%>%
html_node(css = "#DvDetalle_LinkExpediente")%>%
html_attr("href")
#expedientes_url="EXPEDIENTES"
#saveRDS(ExpedienteUrl,file = paste0("Leyes/Exp_",i,".rds"))
data=append(data, ExpedienteUrl)
# expedientes_url
}
data$blankVar <- NA
data$blankVar <- NA
data<-vector()
for (i in 1:100){
UrlExpe <- "https://leyes.congreso.gob.pe/DetLeyNume_1p.aspx?xNorma=6&xNumero="
UrlExpe <- paste0(UrlExpe,NumeroLey[i,1],"&xTipoNorma=0") #1829
options(encoding = "utf-8") # Le asignamos el encoding
#Abrimos una sesion en la web
# Ejecutamos el servidor phantomjs -creamos un navegador fantasma
#server<-phantomjs(port=5012L)
#Abrimos el navegador
Browser <- remoteDriver(browserName = "phantomjs", port=5012L)
Browser$open()
#Sys.sleep(1)
#Navegamos
Browser$navigate(UrlExpe) #
#Sys.sleep(1)
Browser$screenshot(display=TRUE)
#Sys.sleep(1)
#Hacer clic en expediente
Pagina_actual<-Browser$getPageSource()
#De la siguiente forma no hace efecto
# Expediente <- Browser$findElement(using = "css",
#                                   value = "#DvDetalle_LinkExpediente")
# Expediente$clickElement()
# Browser$screenshot(display=TRUE)
#Aqui si funciona
#expedientes_url<-"EXPEDIENTES"
ExpedienteUrl <- read_html(Pagina_actual[[1]])%>%
html_node(css = "#DvDetalle_LinkExpediente")%>%
html_attr("href")
#expedientes_url="EXPEDIENTES"
#saveRDS(ExpedienteUrl,file = paste0("Leyes/Exp_",i,".rds"))
data=append(data, ExpedienteUrl)
# expedientes_url
}
data
View(data)
for (i in 1:nrow(NumeroLey)){
UrlExpe <- "https://leyes.congreso.gob.pe/DetLeyNume_1p.aspx?xNorma=6&xNumero="
UrlExpe <- paste0(UrlExpe,NumeroLey[i,1],"&xTipoNorma=0") #1829
options(encoding = "utf-8") # Le asignamos el encoding
#Abrimos una sesion en la web
# Ejecutamos el servidor phantomjs -creamos un navegador fantasma
#server<-phantomjs(port=5012L)
#Abrimos el navegador
Browser <- remoteDriver(browserName = "phantomjs", port=5012L)
Browser$open()
#Sys.sleep(1)
#Navegamos
Browser$navigate(UrlExpe) #
#Sys.sleep(1)
Browser$screenshot(display=TRUE)
#Sys.sleep(1)
#Hacer clic en expediente
Pagina_actual<-Browser$getPageSource()
#De la siguiente forma no hace efecto
# Expediente <- Browser$findElement(using = "css",
#                                   value = "#DvDetalle_LinkExpediente")
# Expediente$clickElement()
# Browser$screenshot(display=TRUE)
#Aqui si funciona
#expedientes_url<-"EXPEDIENTES"
ExpedienteUrl <- read_html(Pagina_actual[[1]])%>%
html_node(css = "#DvDetalle_LinkExpediente")%>%
html_attr("href")
#expedientes_url="EXPEDIENTES"
#saveRDS(ExpedienteUrl,file = paste0("Leyes/Exp_",i,".rds"))
data=append(data, ExpedienteUrl)
# expedientes_url
}
data
data[174]
data[1]
data[177]
data[9]
data[50]
data[100]
data[150]
# Hoja1 <- readRDS("Leyes/Hojas_1.rds")
# #Juntar toda la data
Archivos <- list.files("Leyes/",pattern = "rds")
TodasLeyes <- read_rds("Leyes/Hojas_1.rds")#  Archivos[1]
for (i in 2:176) {
TodasLeyes <- rbind(TodasLeyes,readRDS(paste0("Leyes/",Archivos[i])))
}
#Eliminar los patrones:"[1 de 176]"
Fucionar <- paste0("[1"," ","de"," ","176]")
Fucionar <- as.list(Fucionar)
Fucionar <- unlist(Fucionar)
#Filtramos
TodasLeyes <- TodasLeyes%>%
filter(!Norma%in%c(Fucionar))
TodasLeyes <- TodasLeyes%>%
filter(Norma!="RESOLUCION LEGISLATIVA")
#
# sapply(TodasLeyes, class)
#
TodasLeyes$Publicación <- as.Date(TodasLeyes$Publicación,format="%d/%m/%Y")
#Ordenamos según fecha
TodasLeyes <- TodasLeyes%>%
arrange(Publicación)
View(TodasLeyes)
# Browser$open()
#
# #Navegamos
# Browser$navigate(UrlLeyes) #
# Browser$screenshot(display=TRUE)
#
# #Decirle que actúe sobre la página actual para rasparlo
# Pagina_actual<-Browser$getPageSource()
#
# #Hacemos un for de 1 a 176
for (j in 1:176) {
print(j)
Pagina_actual<-Browser$getPageSource() # Actuar sobre la página
Pagina<-read_html(Pagina_actual[[1]])
Hojas<-Pagina%>%
html_node(css = "#ctl00_ContentPlaceHolder1_GwDetalle")%>%
html_table(header = T)
#Guardarlo en formato R para luego unirlo con rbind
saveRDS(Hojas,file = paste0("Leyes/Hojas_",j,".rds"))
# Hacer clic en sigiuente hasta 176
SiguienteHoja<-Browser$findElement(using = "css",
value = "#ctl00_ContentPlaceHolder1_GwDetalle_ctl23_ImgBtnSiguiente") #Es Id
SiguienteHoja$clickElement()
#Que descance un rato
Sys.sleep(4)
}
UrlLeyes <- "https://leyes.congreso.gob.pe/LeyNume_1p.aspx?xEstado=2&xTipoNorma=0&xTipoBusqueda=2&xFechaI=01%2f01%2f2000&xFechaF=01%2f12%2f2020&xTexto=&xOrden=0&xNormaI=&xNormaF="
options(encoding = "utf-8") # Le asignamos el encoding
#Abrimos una sesion en la web
# Ejecutamos el servidor phantomjs -creamos un navegador fantasma
server<-phantomjs(port=5012L)
#Abrimos el navegador
Browser <- remoteDriver(browserName = "phantomjs", port=5012L)
Browser$open()
#Navegamos
Browser$navigate(UrlLeyes) #
Browser$screenshot(display=TRUE)
#
# #Decirle que actúe sobre la página actual para rasparlo
# Pagina_actual<-Browser$getPageSource()
#
# #Hacemos un for de 1 a 176
for (j in 1:176) {
print(j)
Pagina_actual<-Browser$getPageSource() # Actuar sobre la página
Pagina<-read_html(Pagina_actual[[1]])
Hojas<-Pagina%>%
html_node(css = "#ctl00_ContentPlaceHolder1_GwDetalle")%>%
html_table(header = T)
#Guardarlo en formato R para luego unirlo con rbind
saveRDS(Hojas,file = paste0("Leyes/Hojas_",j,".rds"))
# Hacer clic en sigiuente hasta 176
SiguienteHoja<-Browser$findElement(using = "css",
value = "#ctl00_ContentPlaceHolder1_GwDetalle_ctl23_ImgBtnSiguiente") #Es Id
SiguienteHoja$clickElement()
#Que descance un rato
#Sys.sleep(4)
}
# Hoja1 <- readRDS("Leyes/Hojas_1.rds")
# #Juntar toda la data
Archivos <- list.files("Leyes/",pattern = "rds")
for (i in 2:176) {
TodasLeyes <- rbind(TodasLeyes,readRDS(paste0("Leyes/",Archivos[i])))
}
# Hoja1 <- readRDS("Leyes/Hojas_1.rds")
# #Juntar toda la data
Archivos <- list.files("Leyes/",pattern = "rds")
TodasLeyes <- read_rds("Leyes/Hojas_1.rds")#  Archivos[1]
for (i in 2:176) {
TodasLeyes <- rbind(TodasLeyes,readRDS(paste0("Leyes/",Archivos[i])))
}
View(TodasLeyes)
Fucionar <- as.list(Fucionar)
#Eliminar los patrones:"[1 de 176]"
Fucionar <- paste0("[1"," ","de"," ","176]")
Fucionar <- as.list(Fucionar)
Fucionar <- unlist(Fucionar)
#Filtramos
TodasLeyes <- TodasLeyes%>%
filter(!Norma%in%c(Fucionar))
TodasLeyes <- TodasLeyes%>%
filter(Norma!="RESOLUCION LEGISLATIVA")
#
# sapply(TodasLeyes, class)
#
TodasLeyes$Publicación <- as.Date(TodasLeyes$Publicación,format="%d/%m/%Y")
#Ordenamos según fecha
TodasLeyes <- TodasLeyes%>%
arrange(Publicación)
#Guardar la data Limpia
saveRDS(TodasLeyes,"Leyes/TodasLeyes.rds")
TodasLeyes <- readRDS("Leyes/TodasLeyes.rds")
NumeroLey <- TodasLeyes$Número
NumeroLey <-as.data.frame(NumeroLey)
NumeroLey[1,1]
server<-phantomjs(port=5012L)
data<-vector()
for (i in 1:nrow(NumeroLey)){
UrlExpe <- "https://leyes.congreso.gob.pe/DetLeyNume_1p.aspx?xNorma=6&xNumero="
UrlExpe <- paste0(UrlExpe,NumeroLey[i,1],"&xTipoNorma=0") #1829
options(encoding = "utf-8") # Le asignamos el encoding
Browser <- remoteDriver(browserName = "phantomjs", port=5012L)
Browser$open()
Browser$navigate(UrlExpe) #
Browser$screenshot(display=TRUE)
Pagina_actual<-Browser$getPageSource()
ExpedienteUrl <- read_html(Pagina_actual[[1]])%>%
html_node(css = "#DvDetalle_LinkExpediente")%>%
html_attr("href")
data=append(data, ExpedienteUrl)
}
data
View(data)
View(NumeroLey)
data[157]
data[151]
saveRDS(data,"exp_url_1171.rds")
setwd("D:/Git Hub-BEST/Populist-metro")
>>>>>>> 649dd686e4eb97f8e7a0fc17c147a225b664198a
